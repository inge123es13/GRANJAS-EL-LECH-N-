<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Granja El Lech칩n 游냥</title>
<style>
  body { font-family: 'Comic Sans MS', Arial, sans-serif; background:#fff0e0; margin:0; padding:0; text-align:center; overflow-x:hidden;}
  header { background:#f28c8c; padding:20px; color:white; font-size:2em; font-weight:bold; text-shadow:2px 2px #b34747; animation:bounce 2s infinite;}
  @keyframes bounce {0%,20%,50%,80%,100%{transform:translateY(0);}40%{transform:translateY(-15px);}60%{transform:translateY(-7px);}}
  .form-container { background:#ffd6cc; padding:20px; border-radius:15px; width:90%; max-width:500px; margin:20px auto; box-shadow:0 0 15px rgba(0,0,0,0.2); animation:fadeIn 1s;}
  label { font-weight:bold; display:block; margin:10px 0 5px; }
  input[type=text], input[type=date], input[type=file], select { width:100%; padding:10px; margin-bottom:15px; border:2px solid #f28c8c; border-radius:10px; }
  button { background:#f28c8c; color:white; padding:10px 15px; border:none; border-radius:10px; cursor:pointer; font-size:1em; margin:2px; transition: transform 0.3s, background 0.3s; }
  button:hover { background:#b34747; transform: scale(1.1); }
  table { width:95%; margin:20px auto; border-collapse:collapse; background:#fff5f5; box-shadow:0 0 15px rgba(0,0,0,0.2); border-radius:10px; animation:fadeIn 1.2s;}
  th, td { border:2px solid #f28c8c; padding:10px; text-align:center; transition:background 0.3s; }
  th { background:#f28c8c; color:white; font-size:1.1em; }
  tr:nth-child(even){background:#ffe0d6;}
  tr:hover td{background:#ffd1c1;}
  .empleado-mes { background:#ffe0e0; padding:20px; border-radius:15px; margin:20px auto; width:90%; max-width:600px; box-shadow:0 0 15px rgba(0,0,0,0.2); animation:fadeIn 1.5s;}
  .empleado-mes h2 { color:#b34747; text-shadow:1px 1px #f28c8c; }
  .fotos-empleado { display:flex; flex-wrap:wrap; justify-content:center; }
  .fotos-empleado div { position:relative; margin:10px; }
  .fotos-empleado img { max-width:150px; max-height:150px; border-radius:10px; border:2px solid #f28c8c; transition:transform 0.5s, box-shadow 0.5s; animation:float 3s ease-in-out infinite alternate;}
  .fotos-empleado img:hover { transform:rotate(-5deg) scale(1.2) translateY(-5px); box-shadow:0 0 15px #f28c8c; }
  .fotos-empleado button { position:absolute; top:-5px; right:-5px; background:#e63946; border:none; border-radius:50%; padding:5px 7px; cursor:pointer; font-size:0.9em; color:white; }
  .fotos-empleado button:hover { background:#b34747; }
  @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  @keyframes float { 0%{transform:translateY(0);}100%{transform:translateY(-10px);} }
</style>
</head>
<body>

<header>游냈 Granja El Lech칩n</header>

<div class="form-container">
  <label>Nombre del puerco:</label>
  <input type="text" id="nombre" placeholder="Ej. La Chata">
  <label>D칤a de monta:</label>
  <input type="date" id="diaMonta">
  <button onclick="agregarPuerco()">Agregar</button>
  <label>Ordenar tabla:</label>
  <select id="ordenTabla" onchange="mostrarTabla()">
    <option value="antiguos">M치s antiguos primero</option>
    <option value="recientes">M치s recientes primero</option>
  </select>
</div>

<table>
  <thead>
    <tr>
      <th>Nombre del puerco</th>
      <th>D칤a de Monta</th>
      <th>Revisi칩n de Monta</th>
      <th>Fecha de Parto</th>
      <th>Pr칩ximo Celo</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="tablaPuerkos"></tbody>
</table>

<div class="empleado-mes">
  <h2>游냥 Empleado del Mes</h2>
  <input type="file" id="fotoEmpleado" accept="image/*">
  <button onclick="agregarFotoEmpleado()">Agregar Foto</button>
  <div class="fotos-empleado" id="fotosEmpleado"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDMnIdtiIvUYP6e68hTCG8XFDzEUz9TT80",
    authDomain: "granja-71b1b.firebaseapp.com",
    projectId: "granja-71b1b",
    storageBucket: "granja-71b1b.appspot.com",
    messagingSenderId: "93657318490",
    appId: "1:93657318490:web:31aa06cd5cc23894ac4463",
    measurementId: "G-SG7MDJRJX8"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  function sumarDias(fecha, dias){ let f=new Date(fecha); f.setDate(f.getDate()+dias); return f; }
  function formatearFecha(fecha){ return new Date(fecha).toLocaleDateString('es-ES', { weekday:'long', day:'numeric', month:'long', year:'numeric' }); }

  // --- PUERCOS ---
  async function agregarPuerco(){
    let nombre=document.getElementById('nombre').value.trim();
    let diaMonta=document.getElementById('diaMonta').value;
    if(!nombre || !diaMonta){ alert("Completa todos los campos"); return; }
    let fechaMonta=new Date(diaMonta+"T00:00:00");
    let revision=sumarDias(fechaMonta,18);
    let parto=sumarDias(fechaMonta,114);
    let proximoCelo=sumarDias(parto,26);
    await addDoc(collection(db,"puercos"), {nombre,diaMonta:fechaMonta.toISOString(),revision:revision.toISOString(),parto:parto.toISOString(),proximoCelo:proximoCelo.toISOString()});
    mostrarTabla();
    document.getElementById('nombre').value="";
    document.getElementById('diaMonta').value=new Date().toISOString().split("T")[0];
  }

  async function mostrarTabla(){
    const orden=document.getElementById('ordenTabla').value;
    let snapshot=await getDocs(collection(db,"puercos"));
    let datos=snapshot.docs.map(d=>({id:d.id,...d.data()}));
    datos.sort((a,b)=>orden==='antiguos'?new Date(a.diaMonta)-new Date(b.diaMonta):new Date(b.diaMonta)-new Date(a.diaMonta));
    const tabla=document.getElementById('tablaPuerkos');
    tabla.innerHTML="";
    datos.forEach(p=>{
      tabla.innerHTML+=`<tr>
        <td>${p.nombre}</td>
        <td>${formatearFecha(p.diaMonta)}</td>
        <td>${formatearFecha(p.revision)}</td>
        <td>${formatearFecha(p.parto)}</td>
        <td>${formatearFecha(p.proximoCelo)}</td>
        <td>
          <button onclick="actualizarPuerco('${p.id}')">Actualizar</button>
          <button onclick="eliminarPuerco('${p.id}')" style="background:#e63946;">Eliminar</button>
        </td>
      </tr>`;
    });
  }

  async function eliminarPuerco(id){ if(confirm("Eliminar puerco?")){ await deleteDoc(doc(db,"puercos",id)); mostrarTabla(); } }
  async function actualizarPuerco(id){
    let nuevaFecha=prompt("Nueva fecha de monta (YYYY-MM-DD):");
    if(!nuevaFecha) return;
    let fechaMonta=new Date(nuevaFecha+"T00:00:00");
    if(isNaN(fechaMonta)){ alert("Fecha inv치lida"); return; }
    await updateDoc(doc(db,"puercos",id),{
      diaMonta:fechaMonta.toISOString(),
      revision:sumarDias(fechaMonta,18).toISOString(),
      parto:sumarDias(fechaMonta,114).toISOString(),
      proximoCelo:sumarDias(sumarDias(fechaMonta,114),26).toISOString()
    });
    mostrarTabla();
  }

  // --- EMPLEADO DEL MES ---
  async function agregarFotoEmpleado(){
    let input=document.getElementById('fotoEmpleado');
    if(input.files && input.files[0]){
      let file=input.files[0];
      let fileRef=ref(storage,'empleados/'+file.name);
      await uploadBytes(fileRef,file);
      let url=await getDownloadURL(fileRef);
      await addDoc(collection(db,"fotosEmpleado"),{url});
      mostrarFotosEmpleado();
    }
  }

  async function mostrarFotosEmpleado(){
    let cont=document.getElementById('fotosEmpleado');
    cont.innerHTML="";
    let snapshot=await getDocs(collection(db,"fotosEmpleado"));
    snapshot.docs.forEach(docItem=>{
      let f=docItem.data();
      let div=document.createElement("div");
      let img=document.createElement("img"); img.src=f.url;
      let btn=document.createElement("button"); btn.textContent="X";
      btn.onclick=async()=>{await deleteDoc(doc(db,"fotosEmpleado",docItem.id)); mostrarFotosEmpleado();}
      div.appendChild(img); div.appendChild(btn); cont.appendChild(div);
    });
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    document.getElementById('diaMonta').value=new Date().toISOString().split("T")[0];
    mostrarTabla(); mostrarFotosEmpleado();
  });

</script>
</body>
</html>
